<!DOCTYPE html>
<html lang="en" xmlns:jad="http://jadaptive.com/jadaptive">
<body>
<div class="wrapper">
<header jad:id="header"></header>
<main class="container my-auto">
   <div class="row justify-content-center">
         <div class="col-10">
            <div class="card">
         	   	<div class="card-header"><span>Authorized Key Upload</span><div class="float-right"><a href="/app/ui/table/authorizedKeys"><i class="fa fa-times"></i></a></div></div>
       			<div class="card-body">		
         	<form id="uploadForm" enctype="multipart/form-data" action="/upload/public-key" method="POST">
      		
      		<div id="nameGroup" class="form-group col-12"> 
          		<label for="name" class="col-form-label">Name</label> 
          		<input type="text" id="name" name="name" class="form-control" value=""> 
          		<small class="form-text text-muted">A name to identify this public key</small> 
         	</div>
		    
		    <div id="uploadHolder" jad:id="uploadWidget" class="w-100"></div>
		    
		</form>
		</div>
         </div>
         </div>
   </div>
</main>
</div>
<script type="text/javascript">
	
	$(document).ready(function() {
	
		$('#uploadForm').submit(function(e) {
			e.preventDefault();
			
			$('#uploadForm .alert').remove();
			
			if($('.file-input').length <= 1) {
				$('#uploadForm').prepend('<p class="alert alert-danger">There are no files selected!</p>');
				return;
			}
			$('.file-input').last().remove();
			
			JadaptiveUtils.startAwesomeSpin($('#uploadButton i', 'upload'));
			
			var form = $(this);
		    var url = form.attr('action');
		    
		    var fd = new FormData($('#uploadForm')[0]);

		    $.ajax({
		           type: "POST",
		           url: url,
		           dataType: "json",
		           contentType: false,
		           processData: false,
		           data: fd,
		           success: function(data)
		           {
		        	   debugger;
		        	   if(data.success) {
		        		   window.location = '/app/ui/table/authorizedKeys';
		        	   } else {
		        		   $('form').prepend('<p class="alert alert-danger">' + data.message + '</p>');
		        		   clearUploads();
		        	   }
		           },
		           always: function() {
		        	   JadaptiveUtils.stopAwesomeSpin($('#uploadButton i', 'upload'));
		           }
		         });
		});
	});
	


</script>
<footer jad:id="footer"></footer>
</body>
</html>